<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.festa.dao.EventDAO">

    <select id="getListOfEvents" resultType="com.festa.dao.EventDTO">
    <![CDATA[
        SELECT
            A.eventTitle,
            A.eventContent,
            A.period,
            A.registerDate,
            A.participants,
            A.writer
        FROM events AS A
        JOIN
            (SELECT
                userNo,
                eventNo,
                eventTitle,
                eventContent,
                period,
                registerDate,
                participants,
                writer
             FROM events
             WHERE userNo < #{PageInfo.cursorUserNo}
             ORDER BY registerDate DESC
             LIMIT #{PageInfo.size}
            ) AS B
        WHERE A.eventNo = B.eventNo
    ]]>
    </select>

    <update id="applyForEvents" parameterType="com.festa.dao.EventDTO">
        UPDATE events
        SET participants = #{participants}
        WHERE eventNo    = #{eventNo}
        AND   eventTitle = #{eventTitle}

    </update>
</mapper>