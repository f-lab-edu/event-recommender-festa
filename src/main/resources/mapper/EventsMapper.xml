<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.festa.dao.EventDAO">

    <select id="getListOfEvents" resultType="com.festa.dao.EventDTO">
        SELECT
            A.eventTitle,
            A.eventContent,
            A.startDate,
            A.endDate,
            EA.cityName,
            EA.districtName,
            EA.streetName,
            A.registerDate,
            M.userName AS writer
        FROM events AS A
        LEFT OUTER JOIN event_address EA
        ON EA.addressNo = A.addressNo
        LEFT OUTER JOIN members M
        ON A.userNo = M.userNo
        JOIN
            (SELECT
                E.userNo,
                E.eventNo,
                E.eventTitle,
                E.eventContent,
                E.startDate,
                E.endDate,
                EA.cityName,
                EA.districtName,
                EA.streetName,
                E.registerDate,
                M.userName AS writer
             FROM events E
             LEFT OUTER JOIN event_address EA
             ON EA.addressNo = E.addressNo
             LEFT OUTER JOIN members M
             ON E.userNo = M.userNo
             WHERE E.userNo <![CDATA[<]]> #{PageInfo.cursorUserNo}
             ORDER BY registerDate DESC
             LIMIT #{PageInfo.size}
            ) AS B
        WHERE A.eventNo = B.eventNo

    </select>

    <insert id="applyForEvents" parameterType="com.festa.model.Participants">
        INSERT INTO
            participant
            (eventNo,
             userNo,
             applyDate,
             participateDate
            )
            VALUES
            (
             #{eventNo},
             #{userNo},
             NOW(),
             NOW()
            )
    </insert>
</mapper>